<!doctype html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="dark" data-sidebar-size="sm-hover"
    data-sidebar-image="none" data-preloader="disable">

<head>

    <meta charset="utf-8" />
    <title>SBYS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesbrand" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/SBYS.png">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="//cdn.jsdelivr.net/npm/jquery.marquee@1.5.0/jquery.marquee.min.js" type="text/javascript"></script>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.css" rel="stylesheet" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/owl-carousel/1.3.3/owl.carousel.js"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/7.2.96/css/materialdesignicons.min.css" />

    <script src="https://momentjs.com/downloads/moment.js"></script>
    <script src="https://momentjs.com/downloads/moment.min.js"></script>
    <script>
        var socketUrl = "ws://78.187.173.201:11280/echo";
    </script>

    <style>
        .avatar-sm {
            height: 3rem;
            width: 3rem
        }

        .job-navbar .dropdown-menu .dropdown-item .avatar-sm {
            height: 2.5rem;
            width: 2.5rem
        }

        .fullscreen-enable [data-toggle=fullscreen] .bx-fullscreen::before {
            content: "\eacb"
        }

        .stretch-card>.card {
            width: 100%;
            min-width: 100%
        }



        /* .owl-carousel .item {
            margin: 3px
        } */

        .owl-carousel .item img {
            /* display: block; */
            width: 100%;
            height: 100%
        }

        /* .owl-carousel .item {
            margin: 3px
        } */

        /* .owl-carousel {
            margin-bottom: 5px;

        }  */

        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
            height: 100%;

        }



        td,
        th {
            border: 1px solid #e9e3e3;
            text-align: left;
            overflow: hidden;
            padding: 5px;
        }

        tr:nth-child(even) {
            background-color: #e6e3e3;
        }

        .marquee3 {
            width: auto;
            overflow: hidden;
        }

        .marquee3 span.line {
            /* padding-top: 6px; */
            color: rgb(22, 20, 20);
            /* font-size: xx-large; */
            text-decoration: white;
        }

        #table_div {
            font-size: 5.3vh;
            margin-left: 10px;
            font-weight: bold;

        }



        /* 
        td {
            margin: 0;
            padding: 0;
        } */

        #images {
            height: 100%;

        }

        /* body {
            overflow: hidden;
        } */

        ::-webkit-scrollbar {
            display: none;
            visibility: hidden;
            opacity: 0
        }
    </style>
</head>

<body>

    <div id="removeNotificationModal" class="modal fade zoomIn" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                        id="NotificationModalbtn-close"></button>
                </div>
                <div class="modal-body">
                    <div class="mt-2 text-center">
                        <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop"
                            colors="primary:#f7b84b,secondary:#f06548" style="width:100px;height:100px"></lord-icon>
                        <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
                            <h4>Are you sure ?</h4>
                            <p class="text-muted mx-4 mb-0">Are you sure you want to remove this Notification ?</p>
                        </div>
                    </div>
                    <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
                        <button type="button" class="btn w-sm btn-light" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn w-sm btn-danger" id="delete-notification">Yes, Delete
                            It!</button>
                    </div>
                </div>

            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <div class="app-menu navbar-menu" style="display: none;">
        <div class="navbar-brand-box">
            <button type="button" class="btn btn-sm p-0 fs-20 header-item float-end btn-vertical-sm-hover"
                id="vertical-hover">
                <i class="ri-record-circle-line"></i>
            </button>
        </div>

        <div id="scrollbar">
            <div class="container-fluid">

                <div id="two-column-menu">
                </div>
                <ul class="navbar-nav" id="navbar-nav">
                </ul>
            </div>
        </div>
        <div class="sidebar-background"></div>
    </div>
    <!-- Begin page -->
    <div id="layout-wrapper">

        <div class="container-fluid">
            <div class="row">
                <div id="notfounddiv" style="text-align: center; display: none;">
                    <img src="./assets/images/multiply-cross.svg" alt="" height="700px" class="mt-5">
                    <h2 class="mt-5" style="color: #e21b1b;">Bu Sayfaya Erişim İzniniz Bulunmamaktadır</h2>
                </div>
                <div class="col-xxl-12 col-xxl-12 col-lg-12 col-md-12 col-sm-12 col-12" id="maindiv">


                    <div class="card" style="margin-bottom: 0; margin-top: 1.5vh; ">
                        <div class="card-header" style="padding: 2px; margin-top: 0;">
                            <div class="row">
                                <div class="col-xxl-1 col-xxl-1 col-lg-1 col-md-1 col-sm-1 mt-0 text-center">
                                    <button type="button" class="btn btn-icon btn-topbar  rounded-circle mt-2"
                                        data-toggle="fullscreen">
                                        <img src="assets/images/SBYS.png" alt="" height="70">
                                    </button>
                                </div>

                                <div class="col-xxl-11 col-xxl-11 col-lg-11 col-md-11 col-sm-11 text-center "
                                    style="padding: 0; margin-top: 1.5vh; margin-bottom: 0px">
                                    <h1 style="font-size: 4vh; margin-bottom: 0px; padding-top: 2px ;">KAYSERİ
                                        SARRAFLAR VE KUYUMCULAR
                                        DERNEĞİ</h1>
                                    <h4>Bu mağazada satılan ürünler Kayseri Sarraflar ve Kuyumcular
                                        Derneği
                                        denetimindedir.</h4>
                                </div>
                            </div>
                        </div>
                        <div class="card-body" style="padding: 0; margin-top: 2.5vh;">

                            <div class="row">
                                <div class="col-sm-12 col-md-12 col-lg-6 col-cl-6 col-xxl-6 mb-0"
                                    style="max-height: 750px; overflow: hidden; padding-right: 0;">
                                    <!-- Striped Rows -->
                                    <table id="currencytab" class="table-responsive" style="overflow: hidden;">
                                        <thead>
                                            <tr>
                                                <th scope="col"></th>
                                                <!-- <th scope="col" class="fs-3">Alış</th> -->
                                                <th scope="col" class="fs-3">Satış</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbodydeger" style="overflow: hidden;">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="col-sm-12 col-md-12 col-lg-6 col-cl-6 col-xxl-6 mb-0"
                                    style="max-height: 750px; overflow: hidden; padding-left: 0;">
                                    <!-- Striped Rows -->
                                    <table id="currencytab1" class="table-responsive" style="overflow: hidden;">
                                        <thead>
                                            <tr>
                                                <th scope="col"></th>
                                                <!-- <th scope="col" class="fs-3">Alış</th> -->
                                                <th scope="col" class="fs-3">Satış</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbodydeger1" style="overflow: hidden;">
                                        </tbody>
                                    </table>

                                </div>
                                <div class="col-sm-12 col-md-12 col-lg-12 col-cl-12 col-xxl-12 mb-0 "
                                    style="max-height: 750px; margin-top: 5px;">
                                    <div id="testacc"
                                        style="background: #18719b;  font-size: 4.5vh; padding: 7px 1px 1px 1px; margin-bottom: 0; margin-top: 0;  overflow: hidden; color: white; display: flex; justify-content: space-evenly;">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="marquee4 text-white" id="duyurlardiv"
                            style="background: #bcc7cc; font-size: 4.5vh; padding: 0; margin-bottom: 0; margin-top: 1vh;  overflow: hidden; color: white;">
                            <span></span>
                        </div>

                        <div class="announcementsmarquee text-white" id="announcements"
                            style="background: #bcc7cc; font-size: 4.5vh; padding: 0; margin-bottom: 0; margin-top: 0;  overflow: hidden; color: white;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>


        var code = "111";
        var currencies = [
            "USD",
            "EUR",
            "GBP",
            "CHF",
            "DKK",
            "SAR",
            "AUD",
            "CAD",
            "JPY",
            "SEK",
            "NOK",]
        var arr = [];
        var altınarr = [];
        var htmlm = "";


        //get user code
        async function getallcode() {
            let url = `viewinformation?msg=getmember&code=${code}`;
            try {
                let res = await fetch(url);
                return await res.json();
            } catch (error) {
                console.log(error);
            }
        }
        var codeok = 0;
        async function renderCode() {
            let rules = await getallcode();
            if (rules == "ok") {
                console.log("BURADA")
            } else {
                $("#notfounddiv").css("display", "");
                $("#maindiv").css("display", "none")
            }
        }
        renderCode();

        //
        //get all symbol
        // sembolleri çeker
        async function getAllSmbol() {
            let url = `/viewinformation?msg=getallsymboll&code=${code}`;
            try {
                let res = await fetch(url);
                return await res.json();
            } catch (error) {
                console.log(error);
            }
        }
        //sadece ilk sefer tabloya basar
        async function renderSymbol() {
            let symbols = await getAllSmbol();
            var html1 = "";
            var html2 = "";
            symbols.forEach(symbol => {

                var currencypk = symbol.map.currencypk;
                var currencyCode = symbol.map.currencyCode;
                var currencyIcon = symbol.map.currencyIcon;
                var currencytitle = symbol.map.currencytitle;
                var currencyvalue = symbol.map.currencyvalue;
                var currencysvalue = symbol.map.currencysvalue;
                var flag = symbol.map.flag;

                currencyvalue = parseInt(currencyvalue);
                currencyvalue = new Intl.NumberFormat("de-DE").format(currencyvalue);
                currencysvalue = parseInt(currencysvalue);
                currencysvalue = new Intl.NumberFormat("de-DE").format(currencysvalue);

                const found = currencies.find(element => element == currencyCode);
                if (found == currencyCode) {
                    if (currencyCode == "EUR" || currencyCode == "USD") {
                        let htmlsegment = `<img src="${currencyIcon}" alt="" class="avatar-sm currency_image mt-2" id="currency_image" data-id="${currencyCode}">
                                                <span class="currency_title" data-id="${currencyCode}">${currencyCode}</span>
                                                <span class="currency_alis" data-id="${currencyCode}"> Alış : ${currencyvalue}</span> 
                                                <span class="currency_satis" data-id="${currencyCode}">  Satış: ${currencysvalue}</span>   &nbsp;`;
                        htmlm += htmlsegment;
                    } else {
                        let htmlsegment = `<img src="${currencyIcon}" alt="" class="avatar-sm currency_image" id="currency_image" data-id="${currencyCode}">
                                                <span class="currency_title" data-id="${currencyCode}">${currencyCode}</span>
                                                <span class="currency_alis" data-id="${currencyCode}"> Alış : ${currencyvalue}</span> 
                                                <span class="currency_satis" data-id="${currencyCode}">- Satış: ${currencysvalue}</span>   &nbsp;`;
                        arr.push(htmlsegment);
                    }
                }
                if (found != currencyCode) {
                    altınarr.push(currencyCode);
                    if (currencyCode == "8Ayr" || currencyCode == "14Ayr" || currencyCode == "18Ayr" || currencyCode == "22Ayr" || currencyCode == "HAS" || currencyCode == "GUMUS") {

                        let htmlsegment1 = `
                                        <tr id="${currencypk}" data-id="${currencypk}" class="tbodydegertr" style="overflow: hidden;">
                                            <td id="${flag}">
                                                
                                                <div id="table_div"  data-id="${currencyCode}" class="liveCurrency"> <i class="" id="${currencyCode}-icon" data-id="0"
                                                            style="color: red;"></i><span class="table_currency_title " data-id="${currencyCode}"> ${currencytitle}</span>
                                                    </div>
                                                </td>
                                               <!--  <td>
                                                    <div id="table_div" class=""><span class="table_currency_alis" data-id="${currencyCode}">${currencyvalue} <img src="./assets/images/svg/crypto-icons/Turkish_lira_symbol_black.svg" alt="" height="30"></span></div>
                                                </td> -->
                                                <td>
                                                    <div id="table_div" class=""><span class="table_currency_satis" id="${currencypk}" data-id="${currencyCode}">${currencysvalue} <img src="./assets/images/svg/crypto-icons/Turkish_lira_symbol_black.svg" alt="" height="30"></span></div>
                                                </td>
                                        </tr>
                                    `;
                        html1 += htmlsegment1;
                    } else {
                        let htmlsegment2 = `
                                    <tr id="${currencypk}" data-id="${currencypk}" class="tbodydegertr" style="overflow: hidden;">
                                        <td id="${flag}">
                                            
                                            <div id="table_div" data-id="${currencyCode}" class="liveCurrency"> <i class="" id="${currencyCode}-icon" data-id="0"
                                                        style="color: red;"></i><span class="table_currency_title " data-id="${currencyCode}"> ${currencytitle}</span>
                                                </div>
                                            </td>
                                            <!-- <td style="overflow : hidden">
                                                <div id="table_div" class="" style="display : ruby" ><span style="overflow : hidden" class="table_currency_alis" data-id="${currencyCode}">${currencyvalue} <img src="./assets/images/svg/crypto-icons/Turkish_lira_symbol_black.svg" alt="" height="30"></span></div>
                                            </td>  -->
                                            <td style="overflow : hidden">
                                                <div id="table_div" class="" style="display : ruby"><span class="table_currency_satis" id="${currencypk}" data-id="${currencyCode}">${currencysvalue} <img src="./assets/images/svg/crypto-icons/Turkish_lira_symbol_black.svg" alt="" height="30"></span></div>
                                            </td>
                                    </tr>
                                `;
                        html2 += htmlsegment2;
                    }
                }
            })
            document.getElementById('testacc').innerHTML += htmlm
            // alt currency
            const options = {
                duration: 11000,
                gap: 50,
                delayBeforeStart: 0,
                direction: 'left',
                duplicated: true
            };

            var html = "";
            for (var i = 0; i < arr.length; i++) {
                var abc = arr[i];
                html += abc;
            }
            var announcementsDom = $("#announcements")
            if (announcementsDom.innerHTML != html) {
                announcementsDom.append(html);
                announcementsDom.marquee(options);
                // $('#testacc').append(html)

            }


            document.getElementById("tbodydeger").innerHTML = html1;
            document.getElementById("tbodydeger1").innerHTML = html2;
            var firsttable = $("#tbodydeger").children('tr');


            function sortTable() {
                var table, rows, switching, i, x, y, shouldSwitch;
                table = document.getElementById("currencytab");
                switching = true;
                while (switching) {
                    switching = false;
                    rows = table.rows;
                    for (i = 1; i < (rows.length - 1); i++) {
                        shouldSwitch = false;
                        x = rows[i].getElementsByTagName("TD")[0];
                        y = rows[i + 1].getElementsByTagName("TD")[0];
                        if (x.getAttribute('id') > y.getAttribute('id')) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                    if (shouldSwitch) {
                        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                        switching = true;
                    }
                }
            }
            function sortTable1() {
                var table1, rows, switching, i, x, y, shouldSwitch;
                table1 = document.getElementById("currencytab1");
                switching = true;
                while (switching) {
                    switching = false;
                    rows = table1.rows;
                    for (i = 1; i < (rows.length - 1); i++) {
                        shouldSwitch = false;
                        x = rows[i].getElementsByTagName("TD")[0];
                        y = rows[i + 1].getElementsByTagName("TD")[0];
                        if (x.getAttribute('id') > y.getAttribute('id')) {
                            shouldSwitch = true;
                            break;
                        }
                    }
                    if (shouldSwitch) {
                        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                        switching = true;
                    }
                }
            }
            sortTable()
            sortTable1()
        }
        renderSymbol()


// abi benim sadece bir şey deniyordum bırakıyorum sana tamam
        // var Arules;
            async function getallrules() {
                let url = "/viewinformation?msg=geallrules";
                try {
                    let res = await fetch(url);
                    //Arules =  res.json();
                    return await res.json() 
                } catch (error) {
                    console.log(error);
                }
            }
            


        var rules;
        async function renderRules(data) {
            if(rules == null){
                rules = await getallrules();
            }
            
            var yeniarr = [];
            for (var b = 0; b < data.length; b++) {
                var test = data[b];
                const found = currencies.find(element => element == test.currency);
                if (found == test.currency) {

                } else {
                    var obj = {};
                    //obj.currencyIcon = test;
                    obj.currencyCode = test.currency;
                    obj.currencyvalue = test.buy;
                    obj.currencysvalue = test.sell;
                    yeniarr.push(obj);
                }
            }

            rules.forEach((rule) => {
                var currencyfk = rule.map.currencyfk;
                var currencyflag = rule.map.currencyflag;
                var currencypk = rule.map.currencypk;
                var currencysvalue = rule.map.currencysvalue;
                var currencytitle = rule.map.currencytitle;
                var currencyRuleCurrencyStep = rule.map.currencysstep
                var max = rule.map.max;
                var min = rule.map.min;
                var rate = rule.map.rate;
                var rulefk = rule.map.rulefk;
                var rulepk = rule.map.rulepk;
                var status = rule.map.status;
                var step = rule.map.step;
                var type = rule.map.type;
                var value = rule.map.value;
                var zone = rule.map.zone;

                if (type == "1") {
                    var tablosatislar = document.getElementsByClassName('table_currency_satis');
                    for (var e = 0; e < tablosatislar.length; e++) {
                        var satislar = tablosatislar[e];
                        var currencyTitle = satislar.getAttribute('data-id');
                        var satispk = satislar.getAttribute('id');
                        if (satispk == currencyfk) {
                            for (var i = 0; i < yeniarr.length; i++) {
                                var onedata = yeniarr[i];
                                var datacode = onedata.currencyCode;
                                var sellingValue = onedata.currencysvalue;
                                sellingValue = getSteppedValue(sellingValue, step);
                                if (datacode === currencyTitle) {
                                    satislar.innerHTML = new Intl.NumberFormat("de-DE").format(sellingValue) + " <img src='./assets/images/svg/crypto-icons/Turkish_lira_symbol_black.svg'  height='30'>";
                                    var currencyIcon = $("#" +currencyTitle +"-icon");
                                    var oldVal = parseFloat(currencyIcon.attr("data-id"));
                                    var change = oldVal > sellingValue ? "mdi mdi-arrow-down-thin text-danger" : "mdi mdi-arrow-up-thin text-success";
                                    console.log(currencyTitle +":" +change);     
                                    currencyIcon.removeClass();
                                    currencyIcon.addClass(change);
                                    currencyIcon.attr("data-id", sellingValue+""); 
                                    break;
                                }

                            }
                            break;
                        }
                    }
                } else if (type == "2") {
                    $.get(`/viewinformation?msg=tablevalues&code=${code}`).done(function (res) {
                        var tablesvalues = [];
                        var response = JSON.parse(res);
                        for (var i = 0; i < response.length; i++) {
                            var zone = response[i];
                            var dumtype = zone.map.dumtype;
                            //console.log(dumtype)
                            if (type == dumtype) {
                                var tablosatislar = document.getElementsByClassName('table_currency_satis');
                                for (var d = 0; d < tablosatislar.length; d++) {
                                    var satislar = tablosatislar[d];
                                    var satisdata = satislar.getAttribute('data-id');
                                    var satispk = satislar.getAttribute('id');
                                    if (satispk == zone.map.currencypk) {
                                        var currencysvalue = zone.map.currencysvalue
                                        currencysvalue = parseInt(currencysvalue);
                                        currencysvalue = new Intl.NumberFormat("de-DE").format(currencysvalue);
                                        satislar.innerHTML = currencysvalue + " <img src='./assets/images/svg/crypto-icons/Turkish_lira_symbol_black.svg'  height='30'>";
                                    }
                                }
                            }
                        }
                    })
                } else {
                    var satis;
                    var mod;
                    var yuvarla;
                    var foreignValue;
                    Number = foreignValue;
                    mod = parseInt(mod)
                    for (var m = 0; m < yeniarr.length; m++) {
                        var oranım = yeniarr[m];
                        if (oranım.currencyCode.toUpperCase() == currencytitle.toUpperCase()) {
                            foreignValue = parseFloat(oranım.currencysvalue);
                            foreignValue = getSteppedValue(foreignValue, currencyRuleCurrencyStep);
                            break;
                        }
                    }
                    var satisdeger = currencysvalue;
                    var oran = rate;
                    var step = step;
                    satis = foreignValue * oran;
                    satis = getSteppedValue(satis, step)
                    satis = parseInt(satis);
                    satis = new Intl.NumberFormat("de-DE").format(satis);

                    var tablosatislar = document.getElementsByClassName('table_currency_satis');
                    //console.log(tablosatislar)
                    for (var d = 0; d < tablosatislar.length; d++) {
                        var satislar = tablosatislar[d];
                        var currencyTitle = satislar.getAttribute('data-id');
                        var satispk = satislar.getAttribute('id');
                        if (satispk == currencyfk) {
                            satislar.innerHTML = satis + " <img src='./assets/images/svg/crypto-icons/Turkish_lira_symbol_black.svg'  height='30'>";
                            var currencyIcon = $("#" +currencyTitle +"-icon");
                            var oldVal = parseFloat(currencyIcon.attr("data-id"));
                            var change = oldVal > sellingValue ? "mdi mdi-arrow-down-thin text-danger" : "mdi mdi-arrow-up-thin text-success";
                            console.log(currencyTitle +":" +change);     
                            currencyIcon.removeClass();
                            currencyIcon.addClass(change);
                            currencyIcon.attr("data-id", sellingValue+""); 
                            break;
                        }
                    }
                }
            })
        }


        

        function getSteppedValue(val, step) {
            val = parseFloat(val);
            var mod = val % step;
            var yuvarla = step - mod;
            if (yuvarla <= (step / 2)) {
                val = val + yuvarla;
            } else {
                val = val - mod;
            }

            return Math.round((val * 100)) / 100;
        }

       




        //döviz kur
        function dovizkur(data) {
            //döviz kurları için
            var yeniarr = [];
            for (var a = 0; a < data.length; a++) {
                var test = data[a];
                const found = currencies.find(element => element == test.currency);
                if (found == test.currency) {
                    var obj = {};
                    //obj.currencyIcon = test;
                    obj.currencyCode = test.currency;
                    obj.currencyvalue = test.buy;
                    obj.currencysvalue = test.sell;
                    yeniarr.push(obj);
                } else {
                    // console.log(test)
                }
            }
            /* Döviz Değerlerini günceller */
            var alis = document.getElementsByClassName('currency_alis');
            for (var a = 0; a < alis.length; a++) {
                var alislar = alis[a];
                var alislardata = alislar.getAttribute('data-id');
                //console.log(alislardata)
                for (var i = 0; i < yeniarr.length; i++) {
                    var objm = yeniarr[i];
                    if (alislardata == objm.currencyCode) {
                        var num = objm.currencyvalue;
                        num = parseFloat(num);
                        let numm = num.toFixed(4);
                        alislar.innerHTML = "Alış :" + numm;
                    }
                }
            }
            var satis = document.getElementsByClassName('currency_satis');
            for (var b = 0; b < satis.length; b++) {
                var satislar = satis[b];
                var satislardata = satislar.getAttribute('data-id');
                // console.log(satislardata)
                for (var i = 0; i < yeniarr.length; i++) {
                    var objm = yeniarr[i];
                    //console.log(objm)
                    if (satislardata == objm.currencyCode) {
                        var num = objm.currencysvalue;
                        num = parseFloat(num);
                        let numm = num.toFixed(4);
                        //console.log(objm.currencysvalue)                             
                        satislar.innerHTML = "&nbsp Satış: " + numm;
                    }
                }
            }
            /* Döviz Değerlerini günceller son*/
        }



        //ok güncelle


        //duyurular
        const options1 = {
            duration: 10000,
            gap: 550,
            delayBeforeStart: 0,
            direction: 'left',
        };
        var duyuruarr = [];
        var htmlduyuru = "";
        var duyurulardom = $("#duyurlardiv");
        $.get("/viewinformation?msg=getallannouncements").done(function (res) {
            var response = JSON.parse(res);
            for (var i = 0; i < response.length; i++) {
                var announcement = response[i];
                var announcementpk = announcement.map.announcementpk;
                var content = announcement.map.content;
                var title = announcement.map.title;
                var startdate = announcement.map.startdate;
                var enddate = announcement.map.enddate;
                var zonecode = announcement.map.zonecode;
                var createdDate = announcement.map.createdDate;
                createdDate = moment(createdDate).format('DD-MM-YYYY');
                startdate = moment(startdate).format('DD-MM-YYYY');
                enddate = moment(enddate).format('DD-MM-YYYY');

                var duyurum = title + " - " + content.trim() + " Başlangıç Tarihi : " + createdDate + " Bitiş Tarihi : " + enddate;
                duyurulardom.append(duyurum);
                duyuruarr.push(duyurum);
            }
            duyurulardom.marquee(options1);
        });



        //web socket
        var lastPrices = {};
        var currencyLists = [
            {
                area: "main",
                currencies: ["GBP", "CHF", "DKK", "SAR"],
            },
            {
                area: "doviz",
                currencies: [
                    "USD",
                    "EUR",
                    "GBP",
                    "CHF",
                    "DKK",
                    "SAR",
                    "AUD",
                    "CAD",
                    "JPY",
                    "SEK",
                    "NOK",
                ],
            },
            {
                area: "parite",
                currencies: [
                    "EURUSD",
                    "GBPUSD",
                    "USDCHF",
                    "USDDKK",
                    "AUDUSD",
                    "USDCAD",
                    "USDJPY",
                    "USDSEK",
                    "USDNOK",
                ],
            },
            {
                area: "altin",
                currencies: ["HAS", "GAUUSD", "GAUEUR", "GUMUS", "ONSUSD", "ONSGUMUS"],
            },
            {
                area: "ziynet",
                currencies: [
                    "CEYREK",
                    "YARIM",
                    "TAM(LIRA)",
                    "GREMSE (2.5)",
                    "ATA LIRA(CUMHURIYET)",
                ],
            },
        ];

        const currencyLabels = [
            {
                currency: "ONSGUMUS",
                label: "ONS GÜMÜŞ",
            },
            {
                currency: "ONSUSD",
                label: "ONS ALTIN",
            },
            {
                currency: "USDNOK",
                label: "Dolar/Norveç Kronu",
            },
            {
                currency: "USDSEK",
                label: "Dolar/İsveç Kronu",
            },
            {
                currency: "USDJPY",
                label: "Dolar/Japon Yeni",
            },
            {
                currency: "USDCAD",
                label: "Dolar/Kanada Doları",
            },
            {
                currency: "USDDKK",
                label: "Dolar/Danimarka Kronu",
            },
            {
                currency: "USDCHF",
                label: "Dolar/İsviçre Frangı",
            },
            {
                currency: "GBP",
                label: "İngiliz Sterlini",
            },
            {
                currency: "CHF",
                label: "İsviçre Frangı",
            },
            {
                currency: "DKK",
                label: "Danimarka Kronu",
            },
            {
                currency: "SAR",
                label: "S.Arabistan Riyali",
            },
            {
                currency: "AUD",
                label: "Avustralya Doları",
            },
            {
                currency: "CAD",
                label: "Kanada Doları",
            },
            {
                currency: "EUR",
                label: "Euro",
            },
            {
                currency: "USD",
                label: "Dolar",
            },
            {
                currency: "HAS",
                label: "Altın",
            },
            {
                currency: "JPY",
                label: "Japon Yeni",
            },
            {
                currency: "SEK",
                label: "İsveç Kronu",
            },
            {
                currency: "NOK",
                label: "Norveç Kronu",
            },
            {
                currency: "GAUUSD",
                label: "Dolar/Kilo",
            },
            {
                currency: "GAUEUR",
                label: "Euro/Kilo",
            },
            {
                currency: "EURUSD",
                label: "Euro/Dolar",
            },
            {
                currency: "GBPUSD",
                label: "Sterlin/Dolar",
            },
            {
                currency: "AUDUSD",
                label: "Avustralya Doları/Dolar",
            },
            {
                currency: "CEYREK",
                label: "Eski Çeyrek",
            },
            {
                currency: "YARIM",
                label: "Eski Yarım",
            },
            {
                currency: "TAM(LIRA)",
                label: "Eski Lira",
            },
            {
                currency: "GREMSE (2.5)",
                label: "Eski Gremse",
            },
            {
                currency: "ATA LIRA(CUMHURIYET)",
                label: "Eski Cumhuriyet",
            },
            {
                currency: "1GRAMLIK",
                label: "Gram Altın (22 ayar)",
            },
            {
                currency: "GUMUS",
                label: "Gümüş",
            },
        ];

        function createRows() {
            currencyLists.map(function (x) {
                var dom = $('.currencyList[area="' + x.area + '"]');
                if (dom.length > 0) {
                    dom.each(function (key, elem) {
                        x.currencies.map(function (c) {
                            var label = currencyLabels.find((x) => x.currency === c);
                            var labelText = label ? "<br><span>" + label.label + "</span>" : "";
                            //   console.log("labelText", c);
                            $(elem).append(
                                '<div class="currency-area-body-body-row tr liveCurrency" currency="' +
                                c +
                                '">\n' +
                                '                                        <div class="item td">' +
                                c +
                                labelText +
                                "</div>\n" +
                                '                                        <div class="item td bp"></div>\n' +
                                '                                        <div class="item td sp"></div>\n' +
                                '                                        <div class="item td"><div class="parity-foot"></div></div>\n' +
                                "                                    </div>"
                            );
                        });
                    });
                }
            });
        }


        function parsePrices(rawData) {
            var fieldData = [
                {
                    index: 0,
                    key: "currency",
                },
                {
                    index: 1,
                    key: "category",
                },
                {
                    index: 3,
                    key: "buy",
                },
                {
                    index: 4,
                    key: "sell",
                },
            ];
            var rows = [];
            rawData.split("\r\n").map((row) => {
                var fields = row.split(";");
                //console.log(fields)
                var parsedData = {};
                fieldData.map(function (d) {
                    parsedData[d.key] = fields[d.index];
                });
                rows.push(parsedData);
            });
            return rows;
        }



        function initWs() {
            if ("WebSocket" in window) {
                createRows();
                console.log("socketUrl", socketUrl);
                var ws = new WebSocket(socketUrl);

                ws.onerror = function (error) {
                    console.log("error ws", error);
                };

                ws.onopen = function () {
                    console.log("onopen");
                };

                ws.onmessage = function (evt) {

                    var received_msg = evt.data;
                    var data = parsePrices(received_msg);
                    // console.log(evt.timeStamp)
                    //updatePrices(data);
                    dovizkur(data);
                    //tabledata(data)
                    renderRules(data);
                    //updatePrices2(data);
                };

                ws.onclose = function () {
                    console.log("closed");
                };
            } else {
                console.log("WebSocket NOT supported by your Browser!");
            }
        }

          
        $(document).ready(function () {
             // rules
            
            
            initWs();
        });

        $(function () {
            console.log("ready!");
        });   
    </script>






    <!-- JAVASCRIPT -->
    <!-- <script src="/assets/js/prices.js"></script> -->
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/feather-icons/feather.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>
    <script src="assets/js/app.js"></script>
</body>

</html>